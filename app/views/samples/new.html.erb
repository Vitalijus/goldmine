<% content_for :title, "Download sample" %>

<%= render "shared/alert" %>
<%= render "shared/notice" %>
<%= render "shared/header" %>

<div class="bg-white px-6 py-8 sm:py-16 lg:px-8 dark:bg-gray-900">
  <div class="mx-auto max-w-3xl text-center">
    <p class="text-base/7 font-semibold text-indigo-600 dark:text-indigo-400">No registration. No subcriptions.</p>
    <h2 class="mt-2 text-3xl font-semibold tracking-tight text-gray-900 sm:text-4xl dark:text-white">Get a Free Sample of Companies Hiring Your Tech Stack</h3>
  </div>
</div>

<div class="bg-white px-6 lg:px-8 dark:bg-gray-900">
  <div class="overflow-visible mx-auto max-w-[900px] w-full overflow-hidden bg-white shadow-sm rounded-xl dark:bg-gray-800/50 dark:shadow-none dark:inset-ring dark:inset-ring-white/10">
    <div class="p-6">
      <h3 class="text-base/7 font-semibold text-gray-900 dark:text-white">FILTERS</h3>
      <p class="mt-1 max-w-full text-sm/6 text-gray-500 dark:text-gray-400">
        Your sample is based on the filters you selected below.
      </p>
    </div>

    <div class="p-6 border-t border-gray-100 dark:border-white/5">
      <%= render "shared/filters", form_action_url: @form_action_url %>
    </div>
  </div>
</div>

<%= form_with(model: @sample, class: "sm:col-span-3 w-full", data: { turbo: false }) do |form| %>
  <div class="bg-white px-6 py-6 lg:px-8 dark:bg-gray-900">
    <div class="mx-auto max-w-[900px] w-full overflow-hidden bg-white shadow-sm rounded-xl dark:bg-gray-800/50 dark:shadow-none dark:inset-ring dark:inset-ring-white/10">
      <div class="px-4 py-6 sm:px-6">
        <h3 class="text-base/7 font-semibold text-gray-900 dark:text-white">DOWNLOAD SAMPLE</h3>
        <p class="mt-1 max-w-full text-sm/6 text-gray-500 dark:text-gray-400">
          Receive a curated list of <span class="text-highligther">10 companies</span> actively hiring developers with your skills — filtered by country, language or framework.
        </p>
      </div>

      <div class="border-t border-gray-100 dark:border-white/5">
        <div class="px-4 sm:px-6 space-y-5">
          <% if @sample.errors.any? %>
            <div class="mt-6 mb-6 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700 dark:border-red-500/30 dark:bg-red-900/20 dark:text-red-300">
              <h2 class="mb-2 text-sm font-semibold">
                <%= pluralize(@sample.errors.count, "error") %> prohibited this sample from being saved:
              </h2>

              <ul class="list-disc space-y-1 pl-5 text-sm">
                <% @sample.errors.each do |error| %>
                  <li><%= error.full_message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>
        </div>

        <div class="px-6 pt-6 pb-0 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <div class="sm:col-span-3">
            <%= form.label :email, "Email Address", class: "block text-sm font-medium text-gray-900 dark:text-white" %>
            <div class="mt-2">
              <%= form.email_field :email, placeholder: "you@example.com", class: "block w-full rounded-md bg-white px-3 py-3 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm dark:bg-white/5 dark:text-white dark:outline-white/10 dark:placeholder:text-gray-500 dark:focus:outline-indigo-500", id: "email" %>
            </div>
            <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
              No spam. Unsubscribe anytime.
            </p>
          </div>
        </div>
        
        <% { countries: :countries, programming_languages: :programming_languages, frameworks: :frameworks, other_tech_stack: :other_tech_stack
           }.each do |param_key, field_name| %>
              <% Array(params[param_key]).each do |value| %>
                <%= hidden_field_tag "sample[#{field_name}][]", value %>
              <% end %>
          <% end %>


        <div class="p-6 text-center flex items-center justify-end gap-x-4">
          <%= form.submit "Get My Free Sample (10 of #{total_companies} companies)", class: "w-full rounded-md bg-indigo-600 px-3.5 py-2.5
          text-sm font-semibold text-white shadow-xs
          hover:bg-indigo-500 focus-visible:outline-2
          focus-visible:outline-offset-2 focus-visible:outline-indigo-600
          dark:bg-indigo-500 dark:hover:bg-indigo-400
          cursor-pointer" %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<div class="bg-white px-6 py-8 sm:py-16 lg:px-8 dark:bg-gray-900">
  <div class="mx-auto max-w-3xl text-center">
    <p class="text-base/7 font-semibold text-indigo-600 dark:text-indigo-400">Unlock complete, country-level datasets with verified hiring signals below.</p>
    <h2 class="mt-2 text-3xl font-semibold tracking-tight text-gray-900 sm:text-4xl dark:text-white">Want the full dataset?</h3>
    </div>
</div>

<!-- List of records -->
<div class="bg-white pb-32 sm:pb-32 px-6 dark:bg-gray-900">
  <ul role="list" class="mx-auto max-w-[900px] w-full divide-y divide-gray-100 overflow-hidden bg-white shadow-xs outline-1 outline-gray-900/5 rounded-xl dark:divide-white/5 dark:bg-gray-800/50 dark:shadow-none dark:outline-white/10 dark:sm:-outline-offset-1">
    <div class="border-b border-gray-200 px-4 py-5 sm:px-6 dark:border-white/10">
      <div class="-mt-2 -ml-4 flex flex-wrap items-center justify-between sm:flex-nowrap">
        <div class="mt-2 ml-4">
          <h3 class="text-base font-semibold text-gray-900 dark:text-white">COUNTRIES</h3>
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
            After completing checkout, you will receive <span class="text-highligther">an email with a link</span> to download the CSV file containing the list of companies.
          </p>
        </div>
      </div>
    </div>

    <% @countries.each do |country| %>
      <li class="relative flex justify-between gap-x-6 px-4 py-5 hover:bg-gray-50 sm:px-6 dark:hover:bg-white/2.5">
        <%= link_to checkout_path(stripe_payment_link: country[:stripe_payment_link],
                                  country: country[:country],
                                  programming_languages: params[:programming_languages],
                                  frameworks: params[:frameworks],
                                  other_tech_stack: params[:other_tech_stack],
                                  remote: params[:remote]),
                                  target: "_blank",
                                  rel: "noopener noreferrer" do %>

          <div class="flex min-w-0 gap-x-4">
            <%= flag_for_country_name_helper(country[:country]) %>

            <div class="min-w-0 flex-auto">
              <p class="text-sm/6 font-semibold text-gray-900 dark:text-white">
                <span class="absolute inset-x-0 -top-px bottom-0"></span>
              </p>
                <%= country[:country] %>
              <p class="mt-1 flex text-xs/5 text-gray-500 dark:text-gray-400">
                <%= pluralize(country[:total_companies], "company") %>
              </p>
            </div>
          </div>
        <% end %>

        <div class="flex shrink-0 items-center gap-x-4">
          <div class="sm:flex sm:flex-col sm:items-end">
            <p class="text-sm/6 text-gray-900 dark:text-white text-right">$<%= country[:price] / 1000 %></p>
            <p class="hidden sm:inline-block mt-1 text-xs/5 text-gray-500 dark:text-gray-400">
              Popular: <%= country[:popular_languages] %>
            </p>
          </div>

          <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5 flex-none text-indigo-600 dark:text-indigo-400">
            <path d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
          </svg>
        </div>
      </li>
    <% end %>

    <div class="px-6 py-8 sm:rounded-b-xl border-t border-gray-50 dark:border-white/5">
      <h4 class="text-sm font-semibold text-gray-900 dark:text-white">
        Trusted and verified data
      </h4>

      <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
        Our country-level datasets are built from verified public and commercial sources and continuously maintained to
        ensure accuracy. We focus on regions with proven startup activity, consistent hiring demand, and strong software
        ecosystems.
      </p>

      <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
        Every record is structured and standardized, including location, technology stack and
        recent hiring signals — so you can make confident decisions without manual research or guesswork.
      </p>

      <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
        There is no subscription lock-in, no hidden fees, and no long-term commitment. You receive exactly what’s shown,
        ready to use immediately.
      </p>

      <p class="mt-4 text-sm font-medium text-indigo-600 dark:text-indigo-400">
        Download once, use forever — or export custom datasets tailored to your needs.
      </p>
    </div>

  </ul>
</div>

<!-- Event view_sample_page tracking for gtag -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    gtag('event', 'view_sample_page', {
      programming_languages: "<%= Array(params[:programming_languages]).join(',') %>",
      countries: "<%= Array(params[:countries]).join(',') %>",
      frameworks: "<%= Array(params[:frameworks]).join(',') %>",
      other_tech_stack: "<%= Array(params[:other_tech_stack]).join(',') %>"
    });
  });
</script>
